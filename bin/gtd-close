#!/bin/bash

source ./gtd-call-check

function usage {
	echo ""
	echo "${ROOT_FOLDER}/gtd close [TASKNO]"
	echo ""
}

set -u

while [[ $# -gt 0 ]]
do
	assert_is_num "${TASK_TO_CLOSE}"
	if grep -w TODO "${ROOT_FOLDER}/${TASKS_FOLDER}/${TASK_TO_CLOSE}/"*
	then
		echo "Cannot close while TODOs exist in files"
	    grep -lw TODO "${ROOT_FOLDER}/${TASKS_FOLDER}/${TASK_TO_CLOSE}"/*
		exit 1
	fi
	"${ROOT_FOLDER}"/bin/gtd move-status closed "${TASK_TO_CLOSE}" || exit 1
	shift
done

git add "${ROOT_FOLDER}"

echo "Closed task ${TASK_TO_CLOSE}"
